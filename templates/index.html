{% load widget_tweaks %}
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
{% block content %}
  <form method="get">
    <div class="well">
      <h4 style="margin-top: 0">Filter</h4>
      <div class="row">
        <div class="form-group col-sm-4 col-md-3">
          Skills : 
          {% render_field filter.form.skills class="form-control" placeholder=form.skills.label %}
        </div>
        <div class="form-group col-sm-4 col-md-3">
          Current Location : 
          {% render_field filter.form.current_location class="form-control" %}
        </div>
        <div class="form-group col-sm-4 col-md-3">
          CTC : 
          {% render_field filter.form.ctc class="form-control" %}
        </div>
        <div class="form-group col-sm-4 col-md-3">
          Preferred Location : 
          {% render_field filter.form.preferred_location class="form-control" %}
        </div>
        <div class="form-group col-sm-4 col-md-3">
          Current Employer :
          {% render_field filter.form.current_employer class="form-control" %}
        </div>
        <div class="form-group col-sm-4 col-md-3">
          Current Designation :
          {% render_field filter.form.current_designation class="form-control" %}
        </div>
      </div>
      <button type="submit" class="btn btn-primary">
        <span class="glyphicon glyphicon-search"></span> Search
      </button>
    </div>
  </form>

{% endblock %}

<head>
<style>
table {
    font-family: arial, sans-serif;
    border-collapse: collapse;
    width: 100%;
}

td, th {
    border: 1px solid #dddddd;
    text-align: left;
    padding: 8px;
}

tr:nth-child(even) {
    background-color: #dddddd;
}
</style>
</head>

<div id="dvData">
    <table class="table table-bordered">
      <thead>
        <tr>
          <th>Name</th>
          <th>Mobile</th>
          <th>Email</th>
          <th>Work Exp</th>
          <th> Analytics Exp </th>
          <th>Skills</th>
          <th>Location</th>
          <th>CTC</th>
          <th>Preferred Location</th>
          <th>Employer</th>
          <th>Designation</th>
          <th>UG Course</th>
          <th>UG Institute</th>
          <th>UG passing year</th>
          <th>PG Course</th>
          <th>PG Institute</th>
          <th>PG passing year</th>
          <th>PostPG Course</th>
        </tr>
      </thead>
      <tbody>
        {% for user in filter.qs %}
          <tr>
            <td>{{user.name}}</td>
            <td>{{user.mobile}}</td>
            <td>{{user.email}}</td>
            <td>{{user.work_exp}}</td>
            <td>{{user.analytics_in_exp}}</td>
            <td>{{user.skills}}</td>
            <td>{{user.current_location}}</td>
            <td>{{user.ctc}}</td>
            <td>{{user.preferred_location}}</td>
            <td>{{user.current_employer}}</td>
            <td>{{user.current_designation}}</td>
            <td>{{user.UG_Course}}</td>
            <td>{{user.UG_Intitute_Name}}</td>
            <td>{{user.UG_Passing_Year}}</td>
            <td>{{user.PG_Course}}</td>
            <td>{{user.PG_Intitute_Name}}</td>
            <td>{{user.PG_Passing_Year}}</td>
            <td>{{user.Post_PG_Course}}</td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="5">No data</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
</div>
<a href="#" class="export">Export Table data into CSV</a>

<!-- JS -->

<script type="text/javascript" src="http://code.jquery.com/jquery-1.7.1.min.js"></script>

<script>
$(document).ready(function () {
        function exportTableToCSV($table, filename) {

            var $headers = $table.find('tr:has(th)')

                ,$rows = $table.find('tr:has(td)')

                // Temporary delimiter characters unlikely to be typed by keyboard

                // This is to avoid accidentally splitting the actual contents

                ,tmpColDelim = String.fromCharCode(11) // vertical tab character

                ,tmpRowDelim = String.fromCharCode(0) // null character



                // actual delimiter characters for CSV format

                ,colDelim = '","'

                ,rowDelim = '"\r\n"';

                // Grab text from table into CSV formatted string

                var csv = '"';

                csv += formatRows($headers.map(grabRow));

                csv += rowDelim;

                csv += formatRows($rows.map(grabRow)) + '"';

                // Data URI

                var csvData = 'data:application/csv;charset=utf-8,' + encodeURIComponent(csv);

            $(this)

                .attr({

                'download': filename

                    ,'href': csvData

                    //,'target' : '_blank' //if you want it to open in a new window

            });

            //------------------------------------------------------------

            // Helper Functions 

            //------------------------------------------------------------

            // Format the output so it has the appropriate delimiters

            function formatRows(rows){

                return rows.get().join(tmpRowDelim)

                    .split(tmpRowDelim).join(rowDelim)

                    .split(tmpColDelim).join(colDelim);

            }

            // Grab and format a row from the table

            function grabRow(i,row){

                 

                var $row = $(row);

                //for some reason $cols = $row.find('td') || $row.find('th') won't work...

                var $cols = $row.find('td'); 

                if(!$cols.length) $cols = $row.find('th');  



                return $cols.map(grabCol)

                            .get().join(tmpColDelim);

            }

            // Grab and format a column from the table 

            function grabCol(j,col){

                var $col = $(col),

                    $text = $col.text();

                return $text.replace('"', '""'); // escape double quotes



            }

        }
        // This must be a hyperlink
        $(".export").click(function (event) {

            var outputFile = window.prompt("What do you want to name your output file (Note: This won't have any effect on Safari)") || 'export';

            outputFile = outputFile.replace('.csv','') + '.csv'

            exportTableToCSV.apply(this, [$('#dvData>table'), outputFile]);
            

            // IF CSV, don't do event.preventDefault() or return false

            // We actually need this to be a typical hyperlink

        });

    });

    </script>


